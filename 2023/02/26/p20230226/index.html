<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="徐奕峰 Eephone Xu"><title>A simple way to import raster data into the PostGIS database · Eephone's GIS Blog</title><meta name="description" content="Outline
Installing the PostGIS Database
Enabling the raster extension in PostGIS
Preparing or creating the raster data
Knowing about the Raster WKB&amp;#x"><meta name="keywords" content="Blog,博客,Hexo,GIS,Java,Vue"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.webp"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="page-top animated fadeInDown"><div class="nav"><li> <a href="/">Home</a></li><li> <a href="/archives">Archives</a></li><li> <a href="/tags">Tags</a></li><li> <a href="/about/me">About</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li><li><a class="fa fa-search" onclick="openWindow();"></a></li></div><div class="avatar"><img src="/images/logo.webp"></div></div></div><div class="sidebar animated fadeInDown"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/logo@2x.webp" style="width:220px;" alt="favicon"><h3 title=""><a href="/">Eephone's GIS Blog</a></h3><div class="description"><p>A GISer's technical blog (2023 new start)</p></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/sheeyphone"><i class="fa fa-github"></i></a></li><li><a href="mailto:sheeyphone@gmail.com"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="http://sighttp.qq.com/authd?IDKEY=331659009"><i class="fa fa-qq"></i></a></li></ul></div></div><div class="footer"><div class="p"> <span> 全站CC-BY-SA-3.0 </span><i class="fa fa-star"></i><span> 徐奕峰 Eephone Xu</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><span>Anatolo </span></div><div class="beian"></div></div></div><div class="main"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>A simple way to import raster data into the PostGIS database</a></h3></div><div class="post-content"><p><h1 id="Outline"><a href="#Outline" class="headerlink" title="Outline"></a>Outline</h1><ol>
<li>Installing the PostGIS Database</li>
<li>Enabling the raster extension in PostGIS</li>
<li>Preparing or creating the raster data</li>
<li>Knowing about the Raster WKB&#x2F;WKT format</li>
<li>Creating the importation-SQL file to execute</li>
</ol>
<h1 id="Tutorial"><a href="#Tutorial" class="headerlink" title="Tutorial"></a>Tutorial</h1><h2 id="1-Installing-the-PostGIS-Database"><a href="#1-Installing-the-PostGIS-Database" class="headerlink" title="1. Installing the PostGIS Database"></a>1. Installing the PostGIS Database</h2><p>The easiest way to install the PostGIS database is using Docker, or you could choose another way to install it. Hence, install the Docker environment and docker-compose plugin on your computer, and here, the hyperlink below is the tutorial and documentation of how to install Docker.</p>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/">Docker Engine installation overview | Docker Documentation</a></p>
<p>Whether the Docker has already installed, you could use docker-compose to run the database by configuring the docker-compose.yml file. The configuration file example is below the paragraph.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.7&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">pgdb:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;postgis/postgis:15-master&quot;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">pgdb</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">POSTGRES_DB:</span> <span class="string">gis_data</span></span><br><span class="line">      <span class="attr">POSTGRES_USER:</span> <span class="string">xyf</span></span><br><span class="line">      <span class="attr">POSTGRES_PASSWORD:</span> <span class="string">xyf</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;/data/postgis/data/:/var/lib/postgresql/data/&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;/data/postgis/tmp/:/tmp&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5432:5432&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;enet&quot;</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">enet:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;enet&quot;</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>Once you have done it and the PostGIS database has been running well, you could make a connection to the database, using the DBMS application such as DBeaver or GIS application addressed QGIS.</p>
<h2 id="2-Enabling-the-raster-extension-in-PostGIS"><a href="#2-Enabling-the-raster-extension-in-PostGIS" class="headerlink" title="2. Enabling the raster extension in PostGIS"></a>2. Enabling the raster extension in PostGIS</h2><p>There are a few extensions supported by PostGIS spatial engine. The default running configuration shows that 3 of these extensions have been enabled. But it was unfortunate to say the raster extension is not enabled by default way. So we should switch on it by ourselves.<br>The first step is to make your command line jump into the docker container, which is the database container you have created before.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker <span class="built_in">exec</span> -it pgdb /bin/bash</span><br></pre></td></tr></table></figure>

<p>After entering the container bash, you could connect to the database by using the command line tool that Postgres offered and named ‘psql’. It’s pretty easy to do. In addition, here are some explanations about the parameters. ‘-U’ is the user and ‘-d’ is the database name. I hope you could find it in the docker-compose configuration file that we have mentioned before.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql -U xyf -d gis_data</span><br></pre></td></tr></table></figure>

<p>After you finish your connection, I would say ‘Congratulation!’ to you and give you the instruction for the next step. These three SQL commands below will help you to enable the postgis_raster extension, and the gdal_drivers and query the status of the available extensions. You would see the result of your query formed as a table heading the name, default_version and installed_version. So easy, isn’t it? Make sure the installed_version of postgis_raster, yes the column is not <code>NULL</code>.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> EXTENSION postgis_raster;</span><br><span class="line"><span class="keyword">SET</span> postgis.gdal_enabled_drivers <span class="operator">=</span> <span class="string">&#x27;ENABLE_ALL&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> name, default_version,installed_version</span><br><span class="line"> <span class="keyword">FROM</span> pg_available_extensions <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;postgis%&#x27;</span> <span class="keyword">or</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;address%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="3-Preparing-or-creating-the-raster-data"><a href="#3-Preparing-or-creating-the-raster-data" class="headerlink" title="3. Preparing or creating the raster data"></a>3. Preparing or creating the raster data</h2><p>I’m sure that you are sure that one of the key steps we should do before importing raster data into the database is owing the raster data. Haha, if you don’t have your own raster data. You could create it using QGIS with the tools called Interpolation or so on. Then, export it into the GeoTiff format and copy or move the GeoTiff file you exported to the file path you have configured on docker-compose.yml and go through our next step.</p>
<p><img src="/images/p20230226_p1.png" alt="Test Raster" title="Test Raster"><br><img src="/images/p20230226_p2.png" alt="Raster Data" title="Raster Data"></p>
<p><code>Suggestions: DO NOT MAKE A LARGE RASTER DATA OR YOU WOULD CRY ON IT!</code></p>
<h2 id="4-Knowing-about-the-Raster-WKB-x2F-WKT-format"><a href="#4-Knowing-about-the-Raster-WKB-x2F-WKT-format" class="headerlink" title="4. Knowing about the Raster WKB&#x2F;WKT format"></a>4. Knowing about the Raster WKB&#x2F;WKT format</h2><p>How does the PostGIS database store the raster data? It’s a pretty good question. As we know that PostGIS store the vector data with data type ‘geometry_column’ or ‘geom’. And the way to store raster data is familiar with it, demonstrating a new data type called ‘raster’ or ‘rast’. When you make a selection by querying some raster data on a database. You would see the HEX result looks like ‘01000001CDDB….’ and it is the WKB&#x2F;WKT data format of a raster. About all, the key to importing raster data into the PostGIS database is converting your own raster data into WKB&#x2F;WKT raster format.</p>
<blockquote>
<p>You may find out the attributes of Raster WKB&#x2F;WKT by clicking the link below.<br><a target="_blank" rel="noopener" href="https://trac.osgeo.org/postgis/wiki/WKTRaster/Documentation01">WKTRaster&#x2F;Documentation01 – PostGIS (osgeo.org)</a></p>
</blockquote>
<h2 id="5-Creating-the-importation-sql-file-to-execute"><a href="#5-Creating-the-importation-sql-file-to-execute" class="headerlink" title="5. Creating the importation-sql file to execute"></a>5. Creating the importation-sql file to execute</h2><p>I would say it’s much more convenient to make the conversion by using the script or tool that PostGIS has already done before, named ‘raster2pgsql’. You could find the usage of ‘raster2pgsql’ via the command ‘raster2pgsql’ after we jump into the container in which the database is running on it. We should find out and reach the path where the testing GeoTiff is waiting for us.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">raster2pgsql -s 4326 -I -C /tmp/test.tif nc.test_raster &gt; test.sql</span><br></pre></td></tr></table></figure>

<p>We may specify the SRID of our raster in the progress, and the example illustrates the parameter with ‘-s 4326’. You could get the explanations about parameters ‘-I’ and ‘-C’ by yourself. ‘&#x2F;tmp&#x2F;test.tif’ is the file path of your GeoTiff file. ‘nc.test_raster’ shows the schema with ‘nc’ and the table name is ‘test_raster’. Finally, the SQL file would be created into the path you running this command and named test.sql.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> &quot;nc&quot;.&quot;test_raster&quot; (&quot;rid&quot; serial <span class="keyword">PRIMARY</span> KEY,&quot;rast&quot; raster);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;nc&quot;.&quot;test_raster&quot; (&quot;rast&quot;) <span class="keyword">VALUES</span> (<span class="string">&#x27;010000010019CC5D8DE459B93F14F061B29570B9BFD174763238005C403E7799994DC0374000000000000000000000000000000000E610000029001A004B000000008087C3C0F355F2B1BB1C394014ED2AA4FC3C39409A780778D25E394016FC36C478813940B1FB8EE1B1A339407714E7A8A3C33940FA4674CFBADE3940111B2C9CA4F13940DAE3857478F839402CF180B229EF3940EB724A404CD23940778192020BA0394083A7902BF55......&#x27;</span>::raster);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX <span class="keyword">ON</span> &quot;nc&quot;.&quot;test_raster&quot; <span class="keyword">USING</span> gist (st_convexhull(&quot;rast&quot;));</span><br><span class="line">ANALYZE &quot;nc&quot;.&quot;test_raster&quot;;</span><br><span class="line"><span class="keyword">SELECT</span> AddRasterConstraints(<span class="string">&#x27;nc&#x27;</span>,<span class="string">&#x27;test_raster&#x27;</span>,<span class="string">&#x27;rast&#x27;</span>,<span class="literal">TRUE</span>,<span class="literal">TRUE</span>,<span class="literal">TRUE</span>,<span class="literal">TRUE</span>,<span class="literal">TRUE</span>,<span class="literal">TRUE</span>,<span class="literal">FALSE</span>,<span class="literal">TRUE</span>,<span class="literal">TRUE</span>,<span class="literal">TRUE</span>,<span class="literal">TRUE</span>,<span class="literal">TRUE</span>);</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<p>You could execute this SQL script using DBeaver, and the ‘nc.test_raster’ would be imported into the database, or you visual it by using QGIS, connecting the database and dropping it into the layers panel. That’s all.</p>
<p><img src="/images/p20230226_p3.png" alt="Finally" title="Finally"><br><img src="/images/p20230226_p4.png" alt="Layer" title="Layer"></p>
<h1 id="References-amp-Documentations"><a href="#References-amp-Documentations" class="headerlink" title="References &amp; Documentations"></a>References &amp; Documentations</h1><p><strong><em>raster2pgsql</em></strong></p>
<p><a target="_blank" rel="noopener" href="https://postgis.docs.acugis.com/en/latest/components/raster2pgsql/index.html#documentation">https://postgis.docs.acugis.com/en/latest/components/raster2pgsql/index.html#documentation</a></p>
<p><strong><em>using_raster_dataman</em></strong></p>
<p><a target="_blank" rel="noopener" href="https://postgis.net/docs/using_raster_dataman.html#RT_Raster_Loader">https://postgis.net/docs/using_raster_dataman.html#RT_Raster_Loader</a></p>
<p><strong><em>docker_hub_postgis</em></strong></p>
<p><a target="_blank" rel="noopener" href="https://hub.docker.com/r/postgis/postgis">https://hub.docker.com/r/postgis/postgis</a></p>
<p><strong><em>WKTRaster</em></strong></p>
<p><a target="_blank" rel="noopener" href="https://trac.osgeo.org/postgis/wiki/WKTRaster/Documentation01">https://trac.osgeo.org/postgis/wiki/WKTRaster/Documentation01</a></p>
</p><div class="tip">本文采用CC-BY-SA-3.0协议，转载请注明出处<br>Author: 徐奕峰 Eephone Xu</div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-02-26</span><i class="fa fa-tag"></i><a class="tag" href="/tags/GIS/" title="GIS">GIS </a><i class="fa fa-tag"></i><a class="tag" href="/tags/Data-importation/" title="Data importation">Data importation </a><i class="fa fa-tag"></i><a class="tag" href="/tags/PostGIS/" title="PostGIS">PostGIS </a><i class="fa fa-tag"></i><a class="tag" href="/tags/Raster/" title="Raster">Raster </a><i class="fa fa-tag"></i><a class="tag" href="/tags/Database/" title="Database">Database </a><span class="leancloud_visitors"></span><span>About 1182 words, 3 min 56 sec  read</span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://gis_eephone_blog.github.io//2023/02/26/p20230226/,Eephone's GIS Blog,A simple way to import raster data into the PostGIS database,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/2023/02/22/p20230222/" title="Introduce how to import GeoJSON data into MongoDB">Next</a></li></ul></div><script src="/js/visitors.js"></script></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script>(function(window){var INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)",},CONTENT_URL:"/content.json",};window.INSIGHT_CONFIG=INSIGHT_CONFIG})(window);</script><script src="/js/insight.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Search..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div></body></html>